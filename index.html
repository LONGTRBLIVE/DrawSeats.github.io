<input id="token" placeholder="输入邀请码" />
<button onclick="draw()">抽座位</button>
<div id="out"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyIcOGGpGCVV0EeybAwKpURpGtUQB_xaPSjlnCLhtDEHxToMndt33lo4PYMapop-Pxd/exec";

async function post(action, token) {
  const form = new URLSearchParams();
  form.set("action", action);
  form.set("token", token);

  const r = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
    body: form.toString(),
  });

  const text = await r.text();
  try { return JSON.parse(text); }
  catch { return { ok:false, error:"NON_JSON_RESPONSE", text }; }
}


async function draw() {
  const token = document.getElementById("token").value.trim();
  const out = document.getElementById("out");
  out.innerText = "抽取中...";

  const status = await post("status", token);
  if (!status.ok) { out.innerText = "邀请码无效"; return; }
  if (status.done) { out.innerText = `你们分支：${status.branch}\n已抽过：${status.seat}`; return; }

  const res = await post("draw", token);
  if (!res.ok) { out.innerText = "抽取失败：" + res.error; return; }

  out.innerText = `✅ 抽取成功\n分支：${res.branch}\n座位：${res.seat}`;
}
</script>
